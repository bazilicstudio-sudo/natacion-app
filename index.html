<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>游끩 Sistema Competencia Elite</title>
<style>
body{margin:0;font-family:sans-serif;background:#0f172a;color:white;padding:15px}
.card{background:#1f2937;padding:15px;border-radius:15px;margin-bottom:15px}
input,select{width:100%;padding:8px;margin:5px 0;border-radius:8px;border:none}
button{padding:8px 12px;margin:4px;border:none;border-radius:8px;font-weight:bold;cursor:pointer}
.btn{background:#2563eb;color:white}
.btn-danger{background:#dc2626;color:white}
.btn-success{background:#16a34a;color:white}
.hidden{display:none}
.lane{
background:#111827;
padding:10px;
margin:8px 0;
border-radius:10px;
display:flex;
justify-content:space-between;
align-items:center;
transition:0.3s;
}
.lane.running{
box-shadow:0 0 15px #22c55e;
animation:pulse 1s infinite;
}
.lane.finished{background:#1e293b;}
@keyframes pulse{
0%{opacity:1}
50%{opacity:0.6}
100%{opacity:1}
}
.ranking{margin-top:10px;font-size:14px}
.nav button{margin-right:6px}
</style>
</head>
<body>

<h2>游끩 Sistema Competencia Elite</h2>

<div id="setupCard" class="card hidden">
<h3>Crear Administrador</h3>
<input type="text" id="adminUser" placeholder="Usuario Admin">
<input type="password" id="adminPass" placeholder="Contrase침a">
<button class="btn-success" onclick="createAdmin()">Crear Cuenta</button>
</div>

<div id="loginCard" class="card hidden">
<h3>Login</h3>
<input type="text" id="loginUser" placeholder="Usuario">
<input type="password" id="loginPass" placeholder="Contrase침a">
<button class="btn" onclick="login()">Ingresar</button>
</div>

<div id="app" class="hidden">

<div class="card">
<button class="btn-danger" onclick="logout()">Cerrar Sesi칩n</button>
</div>

<div class="nav card hidden" id="adminNav">
<button class="btn" onclick="showSection('competition')">Competencia</button>
<button class="btn" onclick="showSection('training')">Entrenamiento</button>
<button class="btn" onclick="showSection('admin')">Administraci칩n</button>
</div>

<div id="competitionSection" class="hidden">

<div class="card">
<h3>Evento</h3>
<input type="text" id="eventName" placeholder="Nombre del evento">
<input type="number" id="laneCount" min="2" max="10" value="8">
<button class="btn-success" onclick="startCompetition()">Iniciar Competencia</button>
</div>

<div class="card">
<h3>Carriles</h3>
<div id="lanes"></div>
</div>

<div class="card">
<h3>Ranking</h3>
<div id="ranking"></div>
</div>

<div class="card">
<h3>Historial</h3>
<div id="history"></div>
</div>

</div>

<div id="trainingSection" class="hidden">
<div class="card">
<h3>Registrar Tiempo Entrenamiento</h3>
<select id="trainingAthlete"></select>
<input type="number" id="trainingTime" placeholder="Tiempo en ms">
<button class="btn" onclick="saveTraining()">Guardar</button>
</div>

<div class="card">
<h3>Historial Entrenamiento</h3>
<div id="trainingHistory"></div>
</div>
</div>

<div id="adminSection" class="hidden">
<div class="card">
<h3>Crear Atleta</h3>
<input type="text" id="newAthlete">
<input type="password" id="newPass" placeholder="Contrase침a">
<button class="btn" onclick="createAthlete()">Crear</button>
</div>

<div class="card">
<h3>Lista Atletas</h3>
<div id="athleteList"></div>
</div>
</div>

<div id="athletePanel" class="hidden">
<div class="card">
<h3>Mis Resultados</h3>
<div id="myResults"></div>
</div>
</div>

</div>

<script>
let db=JSON.parse(localStorage.getItem("eliteDB"))||{
users:[],
competitions:[],
trainings:[]
};

let session=null;
let lanes=[];
let audioCtx=new(window.AudioContext||window.webkitAudioContext)();

function saveDB(){localStorage.setItem("eliteDB",JSON.stringify(db));}

function initSystem(){
if(!db.users.find(u=>u.role==="admin")){
document.getElementById("setupCard").classList.remove("hidden");
}else{
document.getElementById("loginCard").classList.remove("hidden");
}
}

function createAdmin(){
let u=adminUser.value;
let p=adminPass.value;
if(!u||!p)return alert("Completa datos");
db.users.push({user:u,pass:p,role:"admin"});
saveDB();
location.reload();
}

function login(){
let u=loginUser.value;
let p=loginPass.value;
let user=db.users.find(x=>x.user===u && x.pass===p);
if(!user)return alert("Datos incorrectos");
session=user;
document.getElementById("loginCard").classList.add("hidden");
document.getElementById("app").classList.remove("hidden");

if(user.role==="admin"){
adminNav.classList.remove("hidden");
showSection("competition");
loadAthletes();
showHistory();
}else{
athletePanel.classList.remove("hidden");
showAthleteResults();
}
}

function logout(){location.reload();}

function showSection(sec){
competitionSection.classList.add("hidden");
trainingSection.classList.add("hidden");
adminSection.classList.add("hidden");
document.getElementById(sec+"Section").classList.remove("hidden");
}

function createAthlete(){
let name=newAthlete.value;
let pass=newPass.value;
if(!name||!pass)return;
db.users.push({user:name,pass:pass,role:"athlete"});
saveDB();
newAthlete.value="";
newPass.value="";
loadAthletes();
}

function loadAthletes(){
let list=db.users.filter(u=>u.role==="athlete");
athleteList.innerHTML="";
trainingAthlete.innerHTML="";
list.forEach(a=>{
athleteList.innerHTML+=`${a.user} <button class="btn-danger" onclick="deleteAthlete('${a.user}')">Eliminar</button><br>`;
trainingAthlete.innerHTML+=`<option>${a.user}</option>`;
});
}

function deleteAthlete(name){
db.users=db.users.filter(u=>u.user!==name);
db.competitions.forEach(c=>{
c.results=c.results.filter(r=>r.athlete!==name);
});
saveDB();
loadAthletes();
showHistory();
}

function initLanes(){
lanes=[];
lanesDiv.innerHTML="";
let count=parseInt(laneCount.value);
for(let i=1;i<=count;i++){
lanes.push({lane:i,time:0,start:0,interval:null,finished:false,athlete:null});
let options=db.users.filter(u=>u.role==="athlete").map(a=>`<option>${a.user}</option>`).join("");
lanesDiv.innerHTML+=`
<div class="lane" id="lane${i}">
<div>
Carril ${i}
<select id="athlete${i}">
<option value="">Asignar atleta</option>
${options}
</select>
</div>
<div>
<span id="time${i}">00:00.000</span>
<button onclick="stopLane(${i})">Detener</button>
</div>
</div>`;
}
}

function format(ms){
let m=Math.floor(ms/60000);
let s=Math.floor((ms%60000)/1000);
let mil=Math.floor(ms%1000);
return String(m).padStart(2,'0')+":"+String(s).padStart(2,'0')+"."+String(mil).padStart(3,'0');
}

function beep(f,d){
audioCtx.resume();
let o=audioCtx.createOscillator();
o.frequency.value=f;
o.connect(audioCtx.destination);
o.start();
setTimeout(()=>o.stop(),d);
}

function startCompetition(){
initLanes();
beep(800,300);
lanes.forEach(l=>{
let athlete=document.getElementById("athlete"+l.lane).value;
if(!athlete)return;
l.athlete=athlete;
l.start=performance.now();
document.getElementById("lane"+l.lane).classList.add("running");
l.interval=setInterval(()=>{
l.time=performance.now()-l.start;
document.getElementById("time"+l.lane).innerText=format(l.time);
},10);
});
}

function stopLane(n){
let l=lanes.find(x=>x.lane===n);
if(!l||l.finished)return;
clearInterval(l.interval);
l.finished=true;
document.getElementById("lane"+n).classList.remove("running");
document.getElementById("lane"+n).classList.add("finished");
beep(400,200);
updateRanking();
if(lanes.every(x=>x.finished||!x.athlete)){
saveCompetition();
}
}

function updateRanking(){
let ranking=lanes.filter(l=>l.finished&&l.athlete).sort((a,b)=>a.time-b.time);
let medals=["游볞","游볟","游볠"];
rankingDiv.innerHTML="";
ranking.forEach((l,i)=>{
rankingDiv.innerHTML+=`${medals[i]||""} ${l.athlete} - ${format(l.time)}<br>`;
});
}

function saveCompetition(){
let event=eventName.value||"Evento";
let results=lanes.filter(l=>l.athlete).map(l=>({athlete:l.athlete,time:l.time}));
db.competitions.push({event,date:new Date().toLocaleString(),results});
saveDB();
showHistory();
}

function showHistory(){
history.innerHTML="";
db.competitions.forEach((c,i)=>{
history.innerHTML+=`<strong>${c.event}</strong> ${c.date}
<button class="btn-danger" onclick="deleteCompetition(${i})">Eliminar</button><br>`;
c.results.forEach(r=>{
history.innerHTML+=`${r.athlete} - ${format(r.time)}<br>`;
});
history.innerHTML+="<hr>";
});
}

function deleteCompetition(i){
db.competitions.splice(i,1);
saveDB();
showHistory();
}

function saveTraining(){
let athlete=trainingAthlete.value;
let time=parseInt(trainingTime.value);
if(!athlete||!time)return;
db.trainings.push({athlete,time,date:new Date().toLocaleString()});
saveDB();
showTraining();
}

function showTraining(){
trainingHistory.innerHTML="";
db.trainings.forEach(t=>{
trainingHistory.innerHTML+=`${t.athlete} - ${format(t.time)} - ${t.date}<br>`;
});
}

function showAthleteResults(){
myResults.innerHTML="";
db.competitions.forEach(c=>{
c.results.forEach(r=>{
if(r.athlete===session.user){
myResults.innerHTML+=`${c.event} - ${format(r.time)}<br>`;
}
});
});
}

initSystem();
</script>
</body>
</html>
