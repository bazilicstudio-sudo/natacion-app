<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üèä Sistema Competencia Elite</title>

<style>
body{
margin:0;
font-family:sans-serif;
background:#0f172a;
color:white;
padding:10px;
}

.card{
background:#1f2937;
padding:12px;
border-radius:15px;
margin-bottom:12px;
}

button{
padding:12px;
margin:6px 0;
border:none;
border-radius:12px;
font-weight:bold;
cursor:pointer;
font-size:16px;
width:100%;
}

.btn{background:#2563eb;color:white}
.btn-success{background:#16a34a;color:white}
.btn-danger{background:#dc2626;color:white}

.lane{
background:#111827;
padding:15px;
margin:10px 0;
border-radius:15px;
text-align:center;
}

.lane.finished{background:#1e293b;}

.timeDisplay{
font-size:28px;
font-weight:bold;
margin:10px 0;
}

.hidden{display:none}

select,input{
width:100%;
padding:8px;
margin:5px 0;
border-radius:8px;
border:none;
}
</style>
</head>
<body>

<h2>üèä Sistema Competencia Elite</h2>

<div id="setupCard" class="card hidden">
<h3>Crear Administrador</h3>
<input type="text" id="adminUser" placeholder="Usuario Admin">
<input type="password" id="adminPass" placeholder="Contrase√±a">
<button class="btn-success" onclick="createAdmin()">Crear Cuenta</button>
</div>

<div id="loginCard" class="card hidden">
<h3>Login</h3>
<input type="text" id="loginUser" placeholder="Usuario">
<input type="password" id="loginPass" placeholder="Contrase√±a">
<button class="btn" onclick="login()">Ingresar</button>
</div>

<div id="app" class="hidden">

<div class="card">
<button class="btn-danger" onclick="logout()">Cerrar Sesi√≥n</button>
</div>

<div id="adminNav" class="card hidden">
<button class="btn" onclick="showSection('competition')">Competencia</button>
<button class="btn" onclick="showSection('admin')">Administraci√≥n</button>
</div>

<!-- COMPETENCIA -->
<div id="competitionSection" class="hidden">

<div class="card">
<h3>Evento</h3>
<input type="text" id="eventName" placeholder="Nombre del evento">
<input type="number" id="laneCount" min="2" max="10" value="4">
<button class="btn-success" onclick="startCompetition()">Crear Carriles</button>
</div>

<div class="card">
<button class="btn-danger" onclick="prepareStart()">üö¶ PREPARADOS</button>
<div id="startSignal" style="text-align:center;font-size:20px;margin-top:10px;"></div>
</div>

<div class="card">
<div id="lanes"></div>
</div>

<div class="card">
<h3>Ranking</h3>
<div id="ranking"></div>
</div>

</div>

<!-- ADMIN -->
<div id="adminSection" class="hidden">

<div class="card">
<h3>Crear Atleta</h3>
<input type="text" id="newAthlete" placeholder="Nombre">
<input type="password" id="newPass" placeholder="Contrase√±a">
<input type="number" id="newAge" placeholder="Edad">
<select id="newGender">
<option value="">Sexo</option>
<option value="Masculino">Masculino</option>
<option value="Femenino">Femenino</option>
</select>
<input type="text" id="newCategory" placeholder="Categor√≠a">
<button class="btn" onclick="createAthlete()">Crear</button>
</div>

<div class="card">
<h3>Lista Atletas</h3>
<div id="athleteList"></div>
</div>

</div>

</div>

<script>

// ================= VARIABLES =================
let laneTimers = {};
let globalStartTime = null;
let globalInterval = null;
let reactionStartTime = null;
let raceStarted = false;
let results = [];

// ================= INICIO =================
window.onload = () => {
if(!localStorage.getItem("admin")){
setupCard.classList.remove("hidden");
}else{
loginCard.classList.remove("hidden");
}
};

// ================= ADMIN =================
function createAdmin(){
localStorage.setItem("admin",
JSON.stringify({user:adminUser.value,pass:adminPass.value}));
alert("Admin creado");
location.reload();
}

function login(){
const admin=JSON.parse(localStorage.getItem("admin"));
if(loginUser.value===admin.user &&
loginPass.value===admin.pass){
loginCard.classList.add("hidden");
app.classList.remove("hidden");
adminNav.classList.remove("hidden");
showSection("competition");
loadAthletes();
}else{
alert("Credenciales incorrectas");
}
}

function logout(){location.reload();}

function showSection(sec){
competitionSection.classList.add("hidden");
adminSection.classList.add("hidden");
if(sec==="competition")competitionSection.classList.remove("hidden");
if(sec==="admin")adminSection.classList.remove("hidden");
}

// ================= ATLETAS =================
function createAthlete(){
let athletes=JSON.parse(localStorage.getItem("athletes")||"[]");

athletes.push({
user:newAthlete.value,
pass:newPass.value,
age:newAge.value,
gender:newGender.value,
category:newCategory.value
});

localStorage.setItem("athletes",JSON.stringify(athletes));

newAthlete.value="";
newPass.value="";
newAge.value="";
newGender.value="";
newCategory.value="";

loadAthletes();
}

function loadAthletes(){
let athletes=JSON.parse(localStorage.getItem("athletes")||"[]");
athleteList.innerHTML="";
athletes.forEach(a=>{
athleteList.innerHTML+=`
<div>
<strong>${a.user}</strong>
| ${a.gender}
| ${a.age} a√±os
| ${a.category}
</div>`;
});
}

// ================= COMPETENCIA =================
function startCompetition(){

lanes.innerHTML="";
ranking.innerHTML="";
results=[];
laneTimers={};

let athletes=JSON.parse(localStorage.getItem("athletes")||"[]");
let count=parseInt(laneCount.value);

for(let i=1;i<=count;i++){

laneTimers[i]={
finished:false,
currentTime:0,
reactionTime:null,
falseStart:false,
athlete:null
};

let options = athletes.map(a=>
`<option value="${a.user}">
${a.user} | ${a.gender} | ${a.age} a√±os
</option>`).join("");

lanes.innerHTML+=`
<div class="lane" id="lane${i}">
<strong>Carril ${i}</strong>

<select onchange="assignAthlete(${i}, this.value)">
<option value="">Asignar atleta</option>
${options}
</select>

<div id="athleteInfo${i}" style="font-size:14px;margin-top:5px;"></div>

<div class="timeDisplay" id="time${i}">0.000</div>

<button class="btn-success" onclick="finishLane(${i})">
TOCAR
</button>

<div id="reaction${i}" style="font-size:14px;"></div>
</div>`;
}
}

function assignAthlete(lane, username){
let athletes=JSON.parse(localStorage.getItem("athletes")||"[]");
let athlete=athletes.find(a=>a.user===username);
if(!athlete) return;
laneTimers[lane].athlete=athlete;
document.getElementById("athleteInfo"+lane).innerHTML=
`${athlete.gender} | ${athlete.age} a√±os`;
}

// ================= SALIDA =================
function prepareStart(){
raceStarted=false;
startSignal.innerHTML="En sus marcas...";
startSignal.style.color="white";

let randomDelay=Math.floor(Math.random()*2000)+1000;

setTimeout(()=>{
startSignal.innerHTML="¬°YA!";
startSignal.style.color="#22c55e";

reactionStartTime=Date.now();
startAllLanes();
raceStarted=true;

},randomDelay);
}

function startAllLanes(){
globalStartTime=Date.now();
globalInterval=setInterval(()=>{
let now=Date.now();
Object.keys(laneTimers).forEach(i=>{
if(!laneTimers[i].finished){
let elapsed=now-globalStartTime;
laneTimers[i].currentTime=elapsed;
document.getElementById("time"+i).innerText=
(elapsed/1000).toFixed(3);
}
});
},10);
}

function finishLane(i){

if(laneTimers[i].finished) return;

// SALIDA FALSA
if(!raceStarted){
laneTimers[i].falseStart=true;
document.getElementById("lane"+i).style.background="#7f1d1d";
document.getElementById("reaction"+i).innerHTML="‚ùå SALIDA FALSA";
return;
}

laneTimers[i].finished=true;

let now=Date.now();
let reaction=(now-reactionStartTime)/1000;
let finalTime=laneTimers[i].currentTime/1000;

document.getElementById("lane"+i).classList.add("finished");
document.getElementById("reaction"+i).innerHTML=
`Reacci√≥n: ${reaction.toFixed(3)}s`;

let athleteData = laneTimers[i].athlete;

results.push({
lane:i,
time:finalTime,
reaction:reaction,
name: athleteData ? athleteData.user : "Sin atleta",
gender: athleteData ? athleteData.gender : "",
age: athleteData ? athleteData.age : ""
});

results.sort((a,b)=>a.time-b.time);

ranking.innerHTML="";

results.forEach((r,index)=>{
ranking.innerHTML+=`
<div>
${index+1}¬∞ ${r.name}
(Carril ${r.lane})
| ${r.gender} ${r.age ? "- "+r.age+" a√±os" : ""}
| Tiempo: ${r.time.toFixed(3)}s
| Reacci√≥n: ${r.reaction.toFixed(3)}s
</div>`;
});

if(Object.values(laneTimers)
.every(l=>l.finished||l.falseStart)){
clearInterval(globalInterval);
}
}

</script>
</body>
</html>
