<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema Competencia Elite</title>

<style>
body{
margin:0;
font-family:sans-serif;
background:#0f172a;
color:white;
padding:10px;
}
.card{
background:#1f2937;
padding:12px;
border-radius:15px;
margin-bottom:12px;
}
button{
padding:12px;
margin:6px 0;
border:none;
border-radius:12px;
font-weight:bold;
cursor:pointer;
font-size:16px;
width:100%;
}
.btn{background:#2563eb;color:white}
.btn-success{background:#16a34a;color:white}
.btn-danger{background:#dc2626;color:white}
.lane{
background:#111827;
padding:15px;
margin:10px 0;
border-radius:15px;
text-align:center;
}
.lane.finished{background:#1e293b;}
.timeDisplay{
font-size:28px;
font-weight:bold;
margin:10px 0;
}
.hidden{display:none}
select,input{
width:100%;
padding:8px;
margin:5px 0;
border-radius:8px;
border:none;
}
</style>
</head>
<body>

<h2>游끩 Sistema Competencia Elite</h2>

<div id="setupCard" class="card hidden">
<h3>Crear Administrador</h3>
<input type="text" id="adminUser" placeholder="Usuario Admin">
<input type="password" id="adminPass" placeholder="Contrase침a">
<button class="btn-success" onclick="createAdmin()">Crear Cuenta</button>
</div>

<div id="loginCard" class="card hidden">
<h3>Login</h3>
<input type="text" id="loginUser" placeholder="Usuario">
<input type="password" id="loginPass" placeholder="Contrase침a">
<button class="btn" onclick="login()">Ingresar</button>
</div>

<div id="app" class="hidden">

<div class="card">
<button class="btn-danger" onclick="logout()">Cerrar Sesi칩n</button>
</div>

<div id="adminNav" class="card hidden">
<button class="btn" onclick="showSection('competition')">Competencia</button>
<button class="btn" onclick="showSection('admin')">Administraci칩n</button>
</div>

<div id="athleteNav" class="card hidden">
<h3>Panel Atleta</h3>
<div id="athleteInfoPanel"></div>
<button class="btn" onclick="downloadMyResults()">Descargar Mis Resultados</button>
</div>

<!-- COMPETENCIA -->
<div id="competitionSection" class="hidden">
<div class="card">
<input type="number" id="laneCount" min="2" max="10" value="4">
<button class="btn-success" onclick="startCompetition()">Crear Carriles</button>
</div>

<div class="card">
<button class="btn-danger" onclick="prepareStart()">游뚽 PREPARADOS</button>
<div id="startSignal"></div>
</div>

<div class="card">
<div id="lanes"></div>
</div>

<div class="card">
<h3>Ranking</h3>
<div id="ranking"></div>
<button class="btn" onclick="downloadResults()">Descargar Resultados</button>
</div>
</div>

<!-- ADMIN -->
<div id="adminSection" class="hidden">

<div class="card">
<h3>Crear Atleta</h3>
<input type="text" id="newAthlete" placeholder="Nombre">
<input type="password" id="newPass" placeholder="Contrase침a">
<input type="number" id="newAge" placeholder="Edad">
<select id="newGender">
<option value="">Sexo</option>
<option value="Masculino">Masculino</option>
<option value="Femenino">Femenino</option>
</select>
<input type="text" id="newCategory" placeholder="Categor칤a">
<button class="btn" onclick="createAthlete()">Crear</button>
</div>

<div class="card">
<h3>Lista Atletas</h3>
<div id="athleteList"></div>
<button class="btn" onclick="downloadAthletes()">Descargar Lista</button>
</div>

</div>
</div>

<script>

let currentUser=null;
let currentRole=null;
let results=[];

window.onload=()=>{
if(!localStorage.getItem("admin")){
setupCard.classList.remove("hidden");
}else{
loginCard.classList.remove("hidden");
}
};

function createAdmin(){
localStorage.setItem("admin",
JSON.stringify({user:adminUser.value,pass:adminPass.value}));
alert("Admin creado");
location.reload();
}

function login(){
const admin=JSON.parse(localStorage.getItem("admin"));
const athletes=JSON.parse(localStorage.getItem("athletes")||"[]");

if(admin && loginUser.value===admin.user && loginPass.value===admin.pass){
currentUser=admin.user;
currentRole="admin";
adminNav.classList.remove("hidden");
showSection("competition");
}
else{
let athlete=athletes.find(a=>a.user===loginUser.value && a.pass===loginPass.value);
if(athlete){
currentUser=athlete.user;
currentRole="athlete";
athleteNav.classList.remove("hidden");
athleteInfoPanel.innerHTML=
`Nombre: ${athlete.user}<br>
Edad: ${athlete.age}<br>
Sexo: ${athlete.gender}<br>
Categor칤a: ${athlete.category}`;
}
else{
alert("Credenciales incorrectas");
return;
}
}

loginCard.classList.add("hidden");
app.classList.remove("hidden");
loadAthletes();
}

function logout(){location.reload();}

function showSection(sec){
competitionSection.classList.add("hidden");
adminSection.classList.add("hidden");
if(sec==="competition")competitionSection.classList.remove("hidden");
if(sec==="admin")adminSection.classList.remove("hidden");
}

function createAthlete(){
let athletes=JSON.parse(localStorage.getItem("athletes")||"[]");
athletes.push({
user:newAthlete.value,
pass:newPass.value,
age:newAge.value,
gender:newGender.value,
category:newCategory.value
});
localStorage.setItem("athletes",JSON.stringify(athletes));
loadAthletes();
}

function deleteAthlete(user){
let athletes=JSON.parse(localStorage.getItem("athletes")||"[]");
athletes=athletes.filter(a=>a.user!==user);
localStorage.setItem("athletes",JSON.stringify(athletes));
loadAthletes();
}

function loadAthletes(){
let athletes=JSON.parse(localStorage.getItem("athletes")||"[]");
athleteList.innerHTML="";
athletes.forEach(a=>{
athleteList.innerHTML+=`
<div>
${a.user} | ${a.gender} | ${a.age}
<button onclick="deleteAthlete('${a.user}')">Eliminar</button>
</div>`;
});
}

function downloadFile(filename,text){
let blob=new Blob([text],{type:"text/plain"});
let a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download=filename;
a.click();
}

function downloadAthletes(){
let athletes=JSON.parse(localStorage.getItem("athletes")||"[]");
let text="LISTA DE ATLETAS\n\n";
athletes.forEach(a=>{
text+=`${a.user} - ${a.gender} - ${a.age} - ${a.category}\n`;
});
downloadFile("atletas.txt",text);
}

function downloadResults(){
let text="RESULTADOS\n\n";
results.forEach(r=>{
text+=`${r.name} - Tiempo: ${r.time}s - Reacci칩n: ${r.reaction}s\n`;
});
downloadFile("resultados.txt",text);
}

function downloadMyResults(){
let text="MIS RESULTADOS\n\n";
results.filter(r=>r.name===currentUser)
.forEach(r=>{
text+=`Tiempo: ${r.time}s - Reacci칩n: ${r.reaction}s\n`;
});
downloadFile("mis_resultados.txt",text);
}

</script>
</body>
</html>
