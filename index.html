<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema Competencia Elite</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{margin:0;font-family:sans-serif;background:#0f172a;color:white;padding:15px}
.card{background:#1f2937;padding:15px;border-radius:15px;margin-bottom:15px}
input,select{width:100%;padding:8px;margin:5px 0;border-radius:8px;border:none}
button{padding:8px 12px;margin:4px;border:none;border-radius:8px;font-weight:bold;cursor:pointer}
.btn{background:#2563eb;color:white}
.btn-danger{background:#dc2626;color:white}
.btn-success{background:#16a34a;color:white}
.lane{background:#111827;padding:10px;margin:8px 0;border-radius:10px;display:flex;justify-content:space-between;align-items:center}
.lane.running{box-shadow:0 0 15px #22c55e}
</style>
</head>
<body>

<h2>Sistema Competencia Elite</h2>

<div class="card">
<h3>Evento</h3>
<input type="text" id="eventName" placeholder="Nombre del evento">
<input type="text" id="eventTest" placeholder="Nombre de la prueba (Ej: 100m Libre)">
<input type="number" id="eventDistance" placeholder="Metros a competir">
<input type="number" id="laneCount" min="2" max="10" value="8">
<button class="btn-success" onclick="startCompetition()">Crear Carriles</button>
</div>

<div class="card">
<h3>Carriles</h3>
<div id="lanes"></div>
</div>

<div class="card">
<h3>Ranking</h3>
<div id="ranking"></div>
</div>

<div class="card">
<h3>Entrenamiento</h3>
<input type="text" id="trainingAthlete" placeholder="Nombre del atleta">
<input type="number" id="trainingTime" placeholder="Tiempo en ms">
<input type="number" id="trainingHours" placeholder="Horas entrenadas">
<input type="number" id="trainingSeries" placeholder="Series realizadas">
<button class="btn" onclick="saveTraining()">Guardar</button>
</div>

<div class="card">
<h3>Historial Entrenamiento</h3>
<div id="trainingHistory"></div>
</div>

<div class="card">
<h3>Gr√°fico</h3>
<select id="chartAthlete" onchange="updateChart()"></select>
<canvas id="progressChart"></canvas>
</div>

<div class="card">
<h3>An√°lisis</h3>
<div id="performanceAnalysis"></div>
</div>

<div class="card">
<h3>Ranking General</h3>
<div id="globalRanking"></div>
</div>

<script>

// ===============================
// VARIABLES
// ===============================

let lanesData = {};
let results = [];
let progressChart = null;

// ===============================
// CREAR CARRILES
// ===============================

function startCompetition(){
    lanes.innerHTML="";
    results=[];
    lanesData={};
    let count=parseInt(laneCount.value);

    for(let i=1;i<=count;i++){
        lanesData[i]={start:0,elapsed:0,interval:null,running:false};

        lanes.innerHTML+=`
        <div class="lane" id="lane${i}">
        <span>Carril ${i}</span>
        <div>
        <button class="btn" onclick="startLane(${i})">‚ñ∂</button>
        <button class="btn" onclick="pauseLane(${i})">‚è∏</button>
        <button class="btn-success" onclick="finishLane(${i})">üèÅ</button>
        <span id="time${i}">0.000</span>
        </div>
        </div>`;
    }
}

// ===============================
// CONTROL INDIVIDUAL POR CARRIL
// ===============================

function startLane(i){
    if(lanesData[i].running) return;

    lanesData[i].running=true;
    lanesData[i].start=Date.now()-lanesData[i].elapsed;

    lanesData[i].interval=setInterval(()=>{
        lanesData[i].elapsed=Date.now()-lanesData[i].start;
        document.getElementById("time"+i).innerText=
        (lanesData[i].elapsed/1000).toFixed(3);
    },10);
}

function pauseLane(i){
    clearInterval(lanesData[i].interval);
    lanesData[i].running=false;
}

function finishLane(i){
    clearInterval(lanesData[i].interval);
    lanesData[i].running=false;

    let finalTime=(lanesData[i].elapsed/1000);
    results.push({lane:i,time:finalTime});
    results.sort((a,b)=>a.time-b.time);

    ranking.innerHTML="";
    results.forEach((r,index)=>{
        ranking.innerHTML+=`<div>${index+1}¬∞ - Carril ${r.lane} - ${r.time.toFixed(3)}s</div>`;
    });
}

// ===============================
// ENTRENAMIENTO
// ===============================

function saveTraining(){
    let data=JSON.parse(localStorage.getItem("trainingData")||"[]");

    data.push({
        athlete:trainingAthlete.value,
        time:parseFloat(trainingTime.value),
        hours:parseFloat(trainingHours.value),
        series:parseInt(trainingSeries.value),
        date:new Date().toLocaleDateString()
    });

    localStorage.setItem("trainingData",JSON.stringify(data));

    trainingAthlete.value="";
    trainingTime.value="";
    trainingHours.value="";
    trainingSeries.value="";

    loadTraining();
    loadAthletes();
    generatePerformanceAnalysis();
}

function loadTraining(){
    let data=JSON.parse(localStorage.getItem("trainingData")||"[]");
    trainingHistory.innerHTML="";
    data.forEach(d=>{
        trainingHistory.innerHTML+=
        `<div>${d.date} - ${d.athlete} - ${d.time}ms | ${d.hours}h | ${d.series} series</div>`;
    });
}

function loadAthletes(){
    let data=JSON.parse(localStorage.getItem("trainingData")||"[]");
    let athletes=[...new Set(data.map(d=>d.athlete))];

    chartAthlete.innerHTML="";
    athletes.forEach(a=>{
        chartAthlete.innerHTML+=`<option>${a}</option>`;
    });
}

// ===============================
// GR√ÅFICO
// ===============================

function updateChart(){
    let athlete=chartAthlete.value;
    let data=JSON.parse(localStorage.getItem("trainingData")||"[]")
        .filter(d=>d.athlete===athlete);

    let labels=data.map(d=>d.date);
    let times=data.map(d=>d.time);

    if(progressChart) progressChart.destroy();

    progressChart=new Chart(document.getElementById("progressChart"),{
        type:"line",
        data:{labels:labels,datasets:[{label:"Tiempo (ms)",data:times}]}
    });
}

// ===============================
// NIVEL 4 ANAL√çTICA
// ===============================

function getCategory(bestTime){
    if(bestTime<60000) return "Elite";
    if(bestTime<75000) return "Avanzado";
    if(bestTime<90000) return "Intermedio";
    return "Principiante";
}

function generatePerformanceAnalysis(){
    let data=JSON.parse(localStorage.getItem("trainingData")||"[]");
    performanceAnalysis.innerHTML="";
    globalRanking.innerHTML="";

    let athletes=[...new Set(data.map(d=>d.athlete))];
    let ranking=[];

    athletes.forEach(a=>{
        let athleteData=data.filter(d=>d.athlete===a);
        let times=athleteData.map(d=>d.time);

        if(times.length===0) return;

        let best=Math.min(...times);
        let avg=(times.reduce((a,b)=>a+b,0)/times.length).toFixed(2);
        let improvement=times.length>1?(times[0]-times[times.length-1]).toFixed(2):0;

        ranking.push({name:a,best:best});

        performanceAnalysis.innerHTML+=
        `<div style="margin-bottom:8px">
        <strong>${a}</strong><br>
        Mejor: ${best}ms<br>
        Promedio: ${avg}ms<br>
        Mejora: ${improvement}ms<br>
        Categor√≠a: ${getCategory(best)}
        </div>`;
    });

    ranking.sort((a,b)=>a.best-b.best);

    ranking.forEach((r,i)=>{
        globalRanking.innerHTML+=
        `<div>${i+1}¬∞ - ${r.name} - ${r.best}ms</div>`;
    });
}

// ===============================
loadTraining();
loadAthletes();
generatePerformanceAnalysis();

</script>

</body>
</html><!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema Competencia Elite</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{margin:0;font-family:sans-serif;background:#0f172a;color:white;padding:15px}
.card{background:#1f2937;padding:15px;border-radius:15px;margin-bottom:15px}
input,select{width:100%;padding:8px;margin:5px 0;border-radius:8px;border:none}
button{padding:8px 12px;margin:4px;border:none;border-radius:8px;font-weight:bold;cursor:pointer}
.btn{background:#2563eb;color:white}
.btn-danger{background:#dc2626;color:white}
.btn-success{background:#16a34a;color:white}
.lane{background:#111827;padding:10px;margin:8px 0;border-radius:10px;display:flex;justify-content:space-between;align-items:center}
.lane.running{box-shadow:0 0 15px #22c55e}
</style>
</head>
<body>

<h2>Sistema Competencia Elite</h2>

<div class="card">
<h3>Evento</h3>
<input type="text" id="eventName" placeholder="Nombre del evento">
<input type="text" id="eventTest" placeholder="Nombre de la prueba (Ej: 100m Libre)">
<input type="number" id="eventDistance" placeholder="Metros a competir">
<input type="number" id="laneCount" min="2" max="10" value="8">
<button class="btn-success" onclick="startCompetition()">Crear Carriles</button>
</div>

<div class="card">
<h3>Carriles</h3>
<div id="lanes"></div>
</div>

<div class="card">
<h3>Ranking</h3>
<div id="ranking"></div>
</div>

<div class="card">
<h3>Entrenamiento</h3>
<input type="text" id="trainingAthlete" placeholder="Nombre del atleta">
<input type="number" id="trainingTime" placeholder="Tiempo en ms">
<input type="number" id="trainingHours" placeholder="Horas entrenadas">
<input type="number" id="trainingSeries" placeholder="Series realizadas">
<button class="btn" onclick="saveTraining()">Guardar</button>
</div>

<div class="card">
<h3>Historial Entrenamiento</h3>
<div id="trainingHistory"></div>
</div>

<div class="card">
<h3>Gr√°fico</h3>
<select id="chartAthlete" onchange="updateChart()"></select>
<canvas id="progressChart"></canvas>
</div>

<div class="card">
<h3>An√°lisis</h3>
<div id="performanceAnalysis"></div>
</div>

<div class="card">
<h3>Ranking General</h3>
<div id="globalRanking"></div>
</div>

<script>

// ===============================
// VARIABLES
// ===============================

let lanesData = {};
let results = [];
let progressChart = null;

// ===============================
// CREAR CARRILES
// ===============================

function startCompetition(){
    lanes.innerHTML="";
    results=[];
    lanesData={};
    let count=parseInt(laneCount.value);

    for(let i=1;i<=count;i++){
        lanesData[i]={start:0,elapsed:0,interval:null,running:false};

        lanes.innerHTML+=`
        <div class="lane" id="lane${i}">
        <span>Carril ${i}</span>
        <div>
        <button class="btn" onclick="startLane(${i})">‚ñ∂</button>
        <button class="btn" onclick="pauseLane(${i})">‚è∏</button>
        <button class="btn-success" onclick="finishLane(${i})">üèÅ</button>
        <span id="time${i}">0.000</span>
        </div>
        </div>`;
    }
}

// ===============================
// CONTROL INDIVIDUAL POR CARRIL
// ===============================

function startLane(i){
    if(lanesData[i].running) return;

    lanesData[i].running=true;
    lanesData[i].start=Date.now()-lanesData[i].elapsed;

    lanesData[i].interval=setInterval(()=>{
        lanesData[i].elapsed=Date.now()-lanesData[i].start;
        document.getElementById("time"+i).innerText=
        (lanesData[i].elapsed/1000).toFixed(3);
    },10);
}

function pauseLane(i){
    clearInterval(lanesData[i].interval);
    lanesData[i].running=false;
}

function finishLane(i){
    clearInterval(lanesData[i].interval);
    lanesData[i].running=false;

    let finalTime=(lanesData[i].elapsed/1000);
    results.push({lane:i,time:finalTime});
    results.sort((a,b)=>a.time-b.time);

    ranking.innerHTML="";
    results.forEach((r,index)=>{
        ranking.innerHTML+=`<div>${index+1}¬∞ - Carril ${r.lane} - ${r.time.toFixed(3)}s</div>`;
    });
}

// ===============================
// ENTRENAMIENTO
// ===============================

function saveTraining(){
    let data=JSON.parse(localStorage.getItem("trainingData")||"[]");

    data.push({
        athlete:trainingAthlete.value,
        time:parseFloat(trainingTime.value),
        hours:parseFloat(trainingHours.value),
        series:parseInt(trainingSeries.value),
        date:new Date().toLocaleDateString()
    });

    localStorage.setItem("trainingData",JSON.stringify(data));

    trainingAthlete.value="";
    trainingTime.value="";
    trainingHours.value="";
    trainingSeries.value="";

    loadTraining();
    loadAthletes();
    generatePerformanceAnalysis();
}

function loadTraining(){
    let data=JSON.parse(localStorage.getItem("trainingData")||"[]");
    trainingHistory.innerHTML="";
    data.forEach(d=>{
        trainingHistory.innerHTML+=
        `<div>${d.date} - ${d.athlete} - ${d.time}ms | ${d.hours}h | ${d.series} series</div>`;
    });
}

function loadAthletes(){
    let data=JSON.parse(localStorage.getItem("trainingData")||"[]");
    let athletes=[...new Set(data.map(d=>d.athlete))];

    chartAthlete.innerHTML="";
    athletes.forEach(a=>{
        chartAthlete.innerHTML+=`<option>${a}</option>`;
    });
}

// ===============================
// GR√ÅFICO
// ===============================

function updateChart(){
    let athlete=chartAthlete.value;
    let data=JSON.parse(localStorage.getItem("trainingData")||"[]")
        .filter(d=>d.athlete===athlete);

    let labels=data.map(d=>d.date);
    let times=data.map(d=>d.time);

    if(progressChart) progressChart.destroy();

    progressChart=new Chart(document.getElementById("progressChart"),{
        type:"line",
        data:{labels:labels,datasets:[{label:"Tiempo (ms)",data:times}]}
    });
}

// ===============================
// NIVEL 4 ANAL√çTICA
// ===============================

function getCategory(bestTime){
    if(bestTime<60000) return "Elite";
    if(bestTime<75000) return "Avanzado";
    if(bestTime<90000) return "Intermedio";
    return "Principiante";
}

function generatePerformanceAnalysis(){
    let data=JSON.parse(localStorage.getItem("trainingData")||"[]");
    performanceAnalysis.innerHTML="";
    globalRanking.innerHTML="";

    let athletes=[...new Set(data.map(d=>d.athlete))];
    let ranking=[];

    athletes.forEach(a=>{
        let athleteData=data.filter(d=>d.athlete===a);
        let times=athleteData.map(d=>d.time);

        if(times.length===0) return;

        let best=Math.min(...times);
        let avg=(times.reduce((a,b)=>a+b,0)/times.length).toFixed(2);
        let improvement=times.length>1?(times[0]-times[times.length-1]).toFixed(2):0;

        ranking.push({name:a,best:best});

        performanceAnalysis.innerHTML+=
        `<div style="margin-bottom:8px">
        <strong>${a}</strong><br>
        Mejor: ${best}ms<br>
        Promedio: ${avg}ms<br>
        Mejora: ${improvement}ms<br>
        Categor√≠a: ${getCategory(best)}
        </div>`;
    });

    ranking.sort((a,b)=>a.best-b.best);

    ranking.forEach((r,i)=>{
        globalRanking.innerHTML+=
        `<div>${i+1}¬∞ - ${r.name} - ${r.best}ms</div>`;
    });
}

// ===============================
loadTraining();
loadAthletes();
generatePerformanceAnalysis();

</script>

</body>
</html>

