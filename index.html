<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üèä Sistema Competencia PRO</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#111827">

<style>
body{margin:0;font-family:sans-serif;background:#0f172a;color:white;padding:15px}
.card{background:#1f2937;padding:15px;border-radius:15px;margin-bottom:15px}
input,select{width:100%;padding:8px;margin:5px 0;border-radius:8px;border:none}
button{padding:8px 12px;margin:3px;border:none;border-radius:8px;font-weight:bold;cursor:pointer}
.btn{background:#2563eb;color:white}
.btn-danger{background:#dc2626;color:white}
#timer{font-size:2rem;text-align:center;margin:10px 0}
.lane{background:#111827;padding:10px;margin:5px 0;border-radius:10px}
.running{color:#22c55e}
.hidden{display:none}
</style>
</head>
<body>

<h2>üèä Sistema Competencia PRO</h2>

<div id="loginCard" class="card">
<h3>Login</h3>
<select id="role">
<option value="coach">Entrenador</option>
<option value="athlete">Atleta</option>
</select>
<input type="text" id="username" placeholder="Nombre">
<button class="btn" onclick="login()">Ingresar</button>
</div>

<div id="app" class="hidden">

<div class="card">
<button class="btn-danger" onclick="logout()">Cerrar Sesi√≥n</button>
</div>

<div id="coachPanel" class="card hidden">
<h3>Modo Competencia (6 Carriles)</h3>
<button class="btn" onclick="startCompetition()">Iniciar Competencia</button>
<div id="lanes"></div>
<h3>Ranking en Vivo</h3>
<div id="liveRanking"></div>
</div>

<div id="athletePanel" class="card hidden">
<h3>Mi Mejor Tiempo</h3>
<div id="myStats"></div>
</div>

</div>

<script>
let session=JSON.parse(localStorage.getItem("session"))||null;
let athletes=JSON.parse(localStorage.getItem("athletes"))||[];
let lanes=[];
let competitionRunning=false;

function saveData(){
localStorage.setItem("athletes",JSON.stringify(athletes));
}

function login(){
let role=document.getElementById("role").value;
let name=document.getElementById("username").value;
if(!name)return alert("Escribe nombre");
session={role,name};
localStorage.setItem("session",JSON.stringify(session));
initApp();
}

function logout(){
localStorage.removeItem("session");
location.reload();
}

function initApp(){
if(!session)return;
document.getElementById("loginCard").classList.add("hidden");
document.getElementById("app").classList.remove("hidden");

if(session.role==="coach"){
document.getElementById("coachPanel").classList.remove("hidden");
initLanes();
}else{
document.getElementById("athletePanel").classList.remove("hidden");
showAthleteStats();
}
}

function initLanes(){
let container=document.getElementById("lanes");
container.innerHTML="";
lanes=[];
for(let i=1;i<=6;i++){
lanes.push({lane:i,time:0,start:0,interval:null,finished:false});
container.innerHTML+=`
<div class="lane" id="lane${i}">
Carril ${i} - <span id="time${i}">00:00.000</span>
<button onclick="stopLane(${i})">Detener</button>
</div>`;
}
}

function format(ms){
let m=Math.floor(ms/60000);
let s=Math.floor((ms%60000)/1000);
let mil=Math.floor(ms%1000);
return String(m).padStart(2,'0')+":"+String(s).padStart(2,'0')+"."+String(mil).padStart(3,'0');
}

function startCompetition(){
competitionRunning=true;
lanes.forEach(l=>{
l.start=performance.now();
l.interval=setInterval(()=>{
l.time=performance.now()-l.start;
document.getElementById("time"+l.lane).innerText=format(l.time);
},10);
});
}

function stopLane(num){
let lane=lanes.find(l=>l.lane===num);
if(lane.finished)return;
clearInterval(lane.interval);
lane.finished=true;
saveLaneResult(lane.time);
updateLiveRanking();
}

function saveLaneResult(time){
let athlete=athletes.find(a=>a.name===session.name);
if(!athlete){
athlete={name:session.name,times:[]};
athletes.push(athlete);
}
athlete.times.push({time});
saveData();
}

function updateLiveRanking(){
let ranking=lanes.filter(l=>l.finished).sort((a,b)=>a.time-b.time);
let medals=["ü•á","ü•à","ü•â"];
let html="";
ranking.forEach((l,i)=>{
html+=`${medals[i]||""} Carril ${l.lane} - ${format(l.time)}<br>`;
});
document.getElementById("liveRanking").innerHTML=html;
}

function showAthleteStats(){
let athlete=athletes.find(a=>a.name===session.name);
if(!athlete||athlete.times.length===0){
document.getElementById("myStats").innerText="Sin tiempos";
return;
}
let best=Math.min(...athlete.times.map(t=>t.time));
document.getElementById("myStats").innerText="Mejor Tiempo: "+format(best);
}

initApp();
</script>

</body>
</html>

